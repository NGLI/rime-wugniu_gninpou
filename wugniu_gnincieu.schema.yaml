# Rime schema
# encoding: utf-8

schema:
  schema_id: wugniu_gninton
  name: å³èªï¼ˆé„æ±ï¼‰
  version: "0.7.1"
  author:
    - Shin Zoqchiuq <shinzoqchiuq@outlook.com>
  description: |
    æ¡ç”¨å­¸å ‚å¼å³èªæ‹¼éŸ³
    é„æ±å¹³åŸé¾å…¬å»Ÿä¸€å¸¶å£éŸ³
    https://www.wugniu.com/
    https://github.com/NGLI/rime-wugniu_gninpou/
  dependencies:
    - luna_pinyin
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [ğŸˆ‘, ğŸ„°]
  - name: full_shape
    states: [ğŸŒ™, ğŸŒ•]
  - name: simplification
    states: [æ¼¢, æ±‰]
  - name: ascii_punct
    states: [ã€‚ï¼Œ, ï¼ï¼Œ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - affix_segmentor@luna_pinyin # è‡ªå®šç¾©tag luna_pinyin
    - affix_segmentor@stroke      # è‡ªå®šç¾©tag stroke
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator              # ä¸»ç¿»è­¯å™¨
    - script_translator@luna_pinyin  # ç”¨æ–¼åæŸ¥çš„luna_pinyinç¿»è­¯å™¨
    - table_translator@stroke        # ç”¨æ–¼åæŸ¥çš„strokeç¿»è­¯å™¨
    - table_translator@custom_phrase # ç”¨æˆ¶çŸ­èª
  filters:
    - simplifier
    - uniquifier
    - reverse_lookup_filter@reverse_lookup # åæŸ¥æ¿¾é¡

speller:
  alphabet: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    - xform/^([bcdfghjklpqstvwxyz])$/$1_/
    # ç”Ÿæˆé„å·éŸ³ç³»
    - xform/(\w*)-(\w*)/$2/
    - xform/(^y|i)u(?=n)/$1o/
    - derive/([pb]|ph)un/$1oe/
    - xform/mun/moe/
    - xform/uo/o/
    - xform/wo/gho/
    - erase/(^|c|j|gn|kn|[csz]h)(y|i)o$/
    - erase/^-$/

    # å…¼å®¹å³èªå”æœƒå¼æ‹¼éŸ³
    - derive/q/h/
    - derive/(i|y)au/$1o/
    - derive/([gk])ni(?=[nqh]|\d|\b)/nyi/
    - derive/([gk])ni(?=[aoue])/ny/
    - derive/(?<=[szh])yu(?=[nqh])/oe/
    - derive/er/r/

    # èƒ¡ç¬¦ä¸åˆ†
    - derive/wu$/vu/
    - derive/vu$/wu/
    # äº‚æ¼ä¸åˆ†
    - derive/loe/leu/

    # æ–°æ´¾

    # ä¸”é‡‡ä¸åˆ†
    - derive/c(h)?ie$/ts$1e/
    - derive/jie$/dze/
    - derive/(?<=[sz])hie$/e/
    - derive/^ye$/ghe/
    # é™å£¯ä¸åˆ†
    - derive/ciaon/tsaon/
    # ç©¿ç§‹ä¸åˆ†
    - derive/ts(h)?oe$/c$1ieu/
    - derive/dzoe$/jieu/
    - derive/^(s|z)oe$/$1hieu/
    # å®˜å­¤ä¸åˆ†
    - derive/(?<![iy])un/u/
    # æ˜¥æ²–ä¸åˆ† å‡ºä¿ƒä¸åˆ†
    - derive/(?<=[szh])(yu|oe)(?=[nqh])/o/
    # ç¾£çª®ä¸åˆ† ç¼ºåƒä¸åˆ†
    - derive/(^y|i)u(?=[nqh])/$1o/
    - derive/(^y|i)o(?=[nqh])/$1u/
    # ç´„ä¸€ä¸åˆ†
    - derive/ia(?=q|h)/i/
    - derive/ya(?=q|h)/yi/

    # æ¸…é¼»é‚ŠéŸ³
    - derive/([mnl])h/$1/
    - derive/kn/gn/
    - derive/nk/ng/
    # å®¹éŒ¯ gn(ny) => n kn => nh
    - derive/(gn|ny)i/ni/
    - derive/kni/nhi/
    - derive/ny(?=[aoue])/ni/
    # ç°¡æ‹¼
    - abbrev/^([a-z]).+$/$1/
    - abbrev/^([pmtnlszckg]h|[kg]n|n[kg]|tsh?|dz).+$/$1/
    # å®¹éŒ¯ un => oe
    - derive/([pbmw]|ph)un/$1oe/
    - derive/^([kgh]|kh)?un/$1uoe/
    # å®¹éŒ¯ au => ao
    - derive/au/ao/
    # cçµ„è²æ¯å¾Œè‡ªå‹•åŠ i
    - derive/^(c|j|gn|kn|[csz]h)i(?=[aoue])/$1/
    # å®¹éŒ¯ ä»‹éŸ³ã€ä¸»å…ƒéŸ³é †åºèª¿æ›
    - derive/^(.+)([iu])([aeou])([euonqh])$/$1$3$2$4/
    # å®¹éŒ¯ oe => eo
    - derive/oe/eo/
    # å®¹éŒ¯ ao => oa
    - derive/ao/oa/
    # å®¹éŒ¯ ae => ea
    - derive/ae/ea/

# ä¸»ç¿»è­¯å™¨ é„å·å³æ‹¼
translator:
  dictionary: wugniu_gninpou # èª¿å–è©å…¸wugniu_gninpou
  prism: wugniu_gnincieu     # æ ¹æ“šæ‹¼å¯«é‹ç®—ç”Ÿæˆæ£±é¡æ–‡ä»¶wugniu_gnincieu
  spelling_hints: 5          # æ¨™è¨»æ‹¼éŸ³
  comment_format:
    # ç”Ÿæˆé„å·éŸ³ç³»
    - xform/(\w*)-(\w*)/$2/
    - xform/(\by|i)u(?=n)/$1o/
    - xform/([pbm]|ph)un/$1oe/
    - xform/uo/o/
    - xform/wo/gho/
    - xform/(\b|c|j|gn|kn|[csz]h)(y|i)o\b//
    - xform/\b-\b//

# å‰¯ç¿»è­¯å™¨1 æœ™æœˆæ‹¼éŸ³
luna_pinyin:
  tag: luna_pinyin
  dictionary: luna_pinyin # èª¿å–è©å…¸luna_pinyin
  enable_user_dict: false # é—œé–‰ç”¨æˆ¶è©å…¸
  prefix: '`'             # å¼•å°éµã€Œ`ã€
  suffix: "'"             # çµæŸéµã€Œ'ã€
  tips: ã€”æ‹¼éŸ³å€’æŸ¥ã€•         # è¼¸å…¥å‰æç¤ºã€”æ‹¼éŸ³å€’æŸ¥ã€•
  closing_tips: ã€”å³èªï¼ˆé„å·ï¼‰ã€•
  preedit_format:
    - xform/([nl])v/$1Ã¼/
    - xform/([nl])ue/$1Ã¼e/
    - xform/([jqxy])v/$1u/

# å‰¯ç¿»è­¯å™¨2 äº”ç­†ç•«
stroke:
  tag: stroke
  dictionary: stroke      # èª¿å–è©å…¸stroke
  enable_user_dict: false # é—œé–‰ç”¨æˆ¶è©å…¸
  prefix: '`'             # å¼•å°éµã€Œ`ã€
  suffix: "'"             # çµæŸéµã€Œ'ã€
  tips: ã€”ç­†ç•«å€’æŸ¥ã€•         # è¼¸å…¥å‰æç¤ºã€”ç­†ç•«å€’æŸ¥ã€•
  closing_tips: ã€”å³èªï¼ˆé„å·ï¼‰ã€•
  preedit_format:
    - xlit/hspnz/ä¸€ä¸¨ä¸¿ä¸¶ä¹™/

# å‰¯ç¿»è­¯å™¨3 ç”¨æˆ¶çŸ­èª
custom_phrase:
  dictionary: ""
  user_dict: custom_phrase # ç”¨æˆ¶è©å…¸å
  db_class: stabledb       # è©å…¸é¡å‹çˆ²åªè®€æ ¼å¼
  enable_completion: false
  enable_sentence: false
  initial_quality: 1

# åæŸ¥æ¿¾é¡
reverse_lookup:
  tags: [luna_pinyin, stroke] # æ›åœ¨ç¿»è­¯å™¨luna_pinyinå’Œstrokeä¸Š
  overwrite_comment: true     # è¦†è“‹å…¶ä»–æç¤º
  dictionary: wugniu_gninpou  # å€’æŸ¥æ‰€å¾—ç‚ºå¯§æ³¢å³æ‹¼
  comment_format:
    __include: translator/comment_format

punctuator:
  import_preset: symbols # å¥è®€è™•ç†å™¨ï¼Œçµ±ä¸€å¾å¤–éƒ¨å°å…¥

key_binder:
  import_preset: default # å¿«æ·éµï¼Œçµ±ä¸€å¾å¤–éƒ¨å°å…¥

recognizer:
  import_preset: default # ç‰¹æ®Šè¦å‰‡è¼¸å…¥ç¢¼ï¼Œçµ±ä¸€å¾å¤–éƒ¨å°å…¥
  patterns:
    punct: "^/([0-9]|10|[A-Za-z]+)$" # æŒ‰ / è¼¸å…¥ç¬¦è™Ÿ
    luna_pinyin: "`[hspnz]*[aeiouv][a-z]*'?$|`[a-gi-moqrt-y][a-z]*'?$"
    stroke: "`[hspnz]+'?$"
